import{d as m,m as _}from"./vue-9ef19677.js";import{a5 as p,r as f,av as y,b7 as g,Q as l,s as v,A as i,B as r,E as x,x as n,y as o,t as c,I as u,a as h,_ as d}from"./index-9047e9f6.js";import{_ as S}from"./VDataTable-397eb523.js";const C=m({name:"SearchEngine",mixins:[p],data(){return{headers:[{text:"Filename",value:"fileName"},{text:"File Size",value:"fileSize"},{text:"Seeders",value:"nbSeeders"},{text:"Leechers",value:"nbLeechers"},{text:"Site URL",value:"siteUrl"},{text:"",value:"actions",sortable:!1}],searchPattern:"",searchCategory:"all",searchPlugin:"enabled",queryId:0,queryTimer:NaN,queryResults:[],resultFilter:"",mdiClose:f,mdiDownload:y,mdiToyBrick:g}},computed:{..._(["getSearchPlugins","getModals"]),categories(){const s=[{text:"Movies",value:"movies"},{text:"TV shows",value:"tv"},{text:"Music",value:"music"},{text:"Games",value:"games"},{text:"Anime",value:"anime"},{text:"Software",value:"software"},{text:"Pictures",value:"pictures"},{text:"Books",value:"books"}];return s.sort((e,t)=>e.text.localeCompare(t.text)),[{text:"All categories",value:"all"},...s]},plugins(){const s=[{text:"All plugins",value:"all"},{text:"Only enabled",value:"enabled"}];return this.getSearchPlugins().filter(e=>e.enabled).forEach(e=>s.push({text:e.fullName,value:e.name})),s},filteredResults(){return this.queryResults}},async mounted(){await this.$store.dispatch("FETCH_SEARCH_PLUGINS"),document.addEventListener("keydown",this.handleKeyboardShortcut)},async beforeDestroy(){await this.stopSearch(),document.removeEventListener("keydown",this.handleKeyboardShortcut)},methods:{openPluginManager(){this.createModal("SearchPluginManager")},close(){this.$router.back()},async runNewSearch(){const s=await l.startSearch(this.searchPattern,this.searchCategory,[this.searchPlugin]);this.queryId=s.id,this.queryTimer=setInterval(()=>this.refreshResults(),1e3)},async stopSearch(){this.queryId!==0&&await l.stopSearch(this.queryId),this.queryId=0,clearInterval(this.queryTimer)},async refreshResults(){const s=await l.getSearchResults(this.queryId,this.queryResults.length);this.queryResults.push(...s.results),s.status==="Stopped"&&(this.queryId=0,await this.stopSearch())},downloadTorrent(s){this.createModal("AddModal",{initialMagnet:s.fileUrl})},customFilter(s,e){return s!=null&&e!=null&&typeof s=="string"&&e.trim().toLowerCase().split(" ").every(t=>s.toString().toLowerCase().indexOf(t)!==-1)},handleKeyboardShortcut(s){s.key==="Escape"&&this.getModals().length===0&&this.close()}}});var b=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"px-1 px-sm-5 background noselect"},[t(i,{staticClass:"grey--text",attrs:{"no-gutters":"",align:"center",justify:"center"}},[t(r,[t("h1",{staticClass:"subtitle-1 ml-2",staticStyle:{"font-size":"1.6em !important"}},[e._v(" "+e._s(e.$t("search.title"))+" ")])]),t(r,{staticClass:"align-center justify-center"},[t(x,{staticClass:"justify-end"},[t(n,{attrs:{small:"",elevation:"0",color:"primary"},on:{click:e.openPluginManager}},[t(o,[e._v(e._s(e.mdiToyBrick))])],1),t(n,{attrs:{small:"",elevation:"0"},on:{click:e.close}},[t(o,[e._v(e._s(e.mdiClose))])],1)],1)],1)],1),t(c,{attrs:{flat:""}},[t(u,{staticClass:"searchCriterias"},[t(i,{staticClass:"my-2"},[t(r,{attrs:{cols:"12",md:"6"}},[t(h,{attrs:{dense:"","hide-details":"",clearable:"",rules:[a=>!!a||"Search term is required"],label:"Search pattern"},on:{keydown:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:(a.preventDefault(),e.runNewSearch.apply(null,arguments))}},model:{value:e.searchPattern,callback:function(a){e.searchPattern=a},expression:"searchPattern"}})],1),t(r,{attrs:{cols:"6",sm:"5",md:"2"}},[t(d,{attrs:{height:"1",flat:"",dense:"","hide-details":"",outlined:"",items:e.categories,label:"Search category"},model:{value:e.searchCategory,callback:function(a){e.searchCategory=a},expression:"searchCategory"}})],1),t(r,{attrs:{cols:"6",sm:"5",md:"2"}},[t(d,{attrs:{height:"1",flat:"",dense:"","hide-details":"",outlined:"",items:e.plugins,label:"Search plugins"},model:{value:e.searchPlugin,callback:function(a){e.searchPlugin=a},expression:"searchPlugin"}})],1),t(r,{staticClass:"d-flex align-center justify-center",attrs:{cols:"12",sm:"2"}},[e.queryId===0?t(n,{staticClass:"mx-auto accent white--text elevation-0 px-4",on:{click:e.runNewSearch}},[e._v(" "+e._s(e.$t("search.runNewSearch"))+" ")]):t(n,{staticClass:"mx-auto warning white--text elevation-0 px-4",on:{click:e.stopSearch}},[e._v(" "+e._s(e.$t("search.stopSearch"))+" ")])],1)],1)],1)],1),t(c,{staticClass:"mt-5",attrs:{flat:""}},[t(u,{staticClass:"searchResults"},[t(S,{staticStyle:{width:"100%"},attrs:{id:"searchResultsTable",headers:e.headers,items:e.filteredResults,search:e.resultFilter,"custom-filter":e.customFilter},scopedSlots:e._u([{key:"top",fn:function(){return[t(i,{staticClass:"mt-2"},[t(r,{attrs:{cols:"12",md:"6"}},[t(h,{attrs:{dense:"","hide-details":"",label:"Filter"},model:{value:e.resultFilter,callback:function(a){e.resultFilter=a},expression:"resultFilter"}})],1)],1)]},proxy:!0},{key:"item.fileSize",fn:function({item:a}){return[e._v(" "+e._s(e._f("formatSize")(a.fileSize))+" ")]}},{key:"item.actions",fn:function({item:a}){return[t("span",{staticClass:"search-actions"},[t(o,{on:{click:function(P){return e.downloadTorrent(a)}}},[e._v(e._s(e.mdiDownload))])],1)]}}])})],1)],1)],1)},k=[],w=v(C,b,k,!1,null,"e0c8ba43",null,null);const I=w.exports;export{I as default};
