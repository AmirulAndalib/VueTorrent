import{G as ue,b as P,e as ee,_ as ae,a0 as $,a1 as D,a2 as l,k as e,a8 as q,X as k,m as oe,V as T,u as C,W as le,B as ce,$ as de,aa as fe,c as Q,L as ge,q as me,a4 as O,F as he,a5 as ve,an as pe}from"./vue-b6920bd8.js";import{au as ye,av as Se,Z as _,q as Ve,j as H,h as ke,m as U,w as S,x as G,i as J,s as we,t as A,v as W,aa as te,C as be,l as Ee,E as Pe,an as Ce,u as _e,ao as xe,A as N,o as Te,B as x,a9 as $e,ak as qe,al as Ie,p as X,Q as Z,P as Me,aw as Ne}from"./index-86d611d9.js";import"./faker-dcfab09f.js";import"./vuetify-00aeda0f.js";let Y,L,z=0,j=0;function De(u,w,n){let i=w&&n||0;const s=w||new Array(16);u=u||{};let c=u.node||Y,m=u.clockseq!==void 0?u.clockseq:L;if(c==null||m==null){const a=u.random||(u.rng||ye)();c==null&&(c=Y=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),m==null&&(m=L=(a[6]<<8|a[7])&16383)}let v=u.msecs!==void 0?u.msecs:Date.now(),y=u.nsecs!==void 0?u.nsecs:j+1;const p=v-z+(y-j)/1e4;if(p<0&&u.clockseq===void 0&&(m=m+1&16383),(p<0||v>z)&&u.nsecs===void 0&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");z=v,j=y,L=m,v+=122192928e5;const r=((v&268435455)*1e4+y)%4294967296;s[i++]=r>>>24&255,s[i++]=r>>>16&255,s[i++]=r>>>8&255,s[i++]=r&255;const b=v/4294967296*1e4&268435455;s[i++]=b>>>8&255,s[i++]=b&255,s[i++]=b>>>24&15|16,s[i++]=b>>>16&255,s[i++]=m>>>8|128,s[i++]=m&255;for(let a=0;a<6;++a)s[i+a]=c[a];return w||Se(s)}const ne=ue("searchEngine",()=>{const u=P([]),w=P([]);function n(){u.value.push({uniqueId:De(),id:0,query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function i(a){u.value=u.value.filter(E=>E.uniqueId!==a)}async function s(a){const E=await _.startSearch(a.query,a.filters.category,[a.filters.plugin]);a.id=E.id,a.results=[]}async function c(a){const E=await _.getSearchResults(a.id,a.results.length);return a.results.push(...E.results),E.status}async function m(a){a.id&&a.id!==0&&await _.stopSearch(a.id),a.id=0}async function v(){w.value=await _.getSearchPlugins()}async function y(a){await _.installSearchPlugin([a])}async function p(a){await _.uninstallSearchPlugin([a])}async function r(a){await _.enableSearchPlugin([a.name],!a.enabled)}async function b(){await _.updateSearchPlugins()}return{searchData:u,searchPlugins:w,createNewTab:n,deleteTab:i,runNewSearch:s,refreshResults:c,stopSearch:m,fetchSearchPlugins:v,installSearchPlugin:y,uninstallSearchPlugin:p,toggleSearchPlugin:r,updatePlugins:b}},{persist:{enabled:!0,strategies:[{storage:sessionStorage,key:"vuetorrent_searchEngine"}]}}),Ue=["href","title"],Be=ee({__name:"PluginManagerDialog",props:{guid:{}},setup(u){const w=u,{isOpened:n}=Ve(w.guid),{t:i}=ae(),s=ne(),c=[{title:i("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:i("dialogs.pluginManager.headers.name"),key:"fullName"},{title:i("dialogs.pluginManager.headers.version"),key:"version"},{title:i("dialogs.pluginManager.headers.url"),key:"url"},{title:i("dialogs.pluginManager.headers.actions"),key:"actions"}],m=P(!1),v=P(!1),y=P(!1),p=P(!1),r=P("");async function b(h){await s.toggleSearchPlugin(h),await s.fetchSearchPlugins()}async function a(){v.value=!0,await s.updatePlugins().then(()=>new Promise(h=>setTimeout(h,2e3))),await s.fetchSearchPlugins(),v.value=!1}async function E(){I(),m.value=!0,await s.installSearchPlugin(r.value),r.value="",setTimeout(()=>{s.fetchSearchPlugins().then(()=>{m.value=!1})},1e3)}async function B(h){m.value=!0,await s.uninstallSearchPlugin(h.name),await s.fetchSearchPlugins(),m.value=!1}const d=()=>{n.value=!1};function I(){y.value=!1}return(h,V)=>($(),D(G,{modelValue:C(n),"onUpdate:modelValue":V[4]||(V[4]=o=>ce(n)?n.value=o:null)},{default:l(()=>[e(H,null,{default:l(()=>[e(ke,{class:"d-flex"},{default:l(()=>[q("div",null,k(h.$t("dialogs.pluginManager.title")),1),e(U),e(S,{text:h.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:v.value,onClick:a},null,8,["text","loading"]),e(G,{modelValue:y.value,"onUpdate:modelValue":V[3]||(V[3]=o=>y.value=o)},{activator:l(({props:o})=>[e(S,oe(o,{color:"primary"}),{default:l(()=>[T(k(h.$t("dialogs.pluginManager.install.activator")),1)]),_:2},1040)]),default:l(()=>[e(H,{title:h.$t("dialogs.pluginManager.install.title")},{default:l(()=>[e(J,null,{default:l(()=>[e(C(we),{modelValue:p.value,"onUpdate:modelValue":V[1]||(V[1]=o=>p.value=o),onSubmit:V[2]||(V[2]=le(()=>{},["prevent"]))},{default:l(()=>[e(A,{modelValue:r.value,"onUpdate:modelValue":V[0]||(V[0]=o=>r.value=o),autofocus:"",label:h.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(W,null,{default:l(()=>[e(U),e(S,{color:"error",onClick:I},{default:l(()=>[T(k(h.$t("common.cancel")),1)]),_:1}),e(S,{color:"accent",onClick:E},{default:l(()=>[T(k(h.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(J,null,{default:l(()=>[e(te,{headers:c,"items-per-page":"-1",items:C(s).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:m.value},{"item.enabled":l(({item:o})=>[e(be,{"model-value":o.enabled,onClick:M=>b(o)},null,8,["model-value","onClick"])]),"item.url":l(({item:o})=>[q("a",{href:o.url,title:o.name},k(o.url),9,Ue)]),"item.actions":l(({item:o})=>[e(Ee,{color:"red",icon:"mdi-delete",onClick:M=>B(o)},null,8,["onClick"])]),tfoot:l(()=>[]),_:1},8,["items","loading"])]),_:1}),e(W,null,{default:l(()=>[e(U),e(S,{color:"accent",onClick:d},{default:l(()=>[T(k(h.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Re={class:"pa-3"},Le={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},ze={class:"d-flex justify-end"},Oe=ee({__name:"SearchEngine",setup(u){const w=de(),{t:n}=ae(),i=Pe(),s=Ce(),c=ne(),m=_e(),v=P(),y=P(!1),p=P(0),{searchData:r}=fe(c),b=[{title:n("searchEngine.headers.fileName"),key:"fileName"},{title:n("searchEngine.headers.fileSize"),key:"fileSize"},{title:n("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:n("searchEngine.headers.nbLeechers"),key:"nbLeechers"},{title:n("searchEngine.headers.siteUrl"),key:"siteUrl"},{title:"",key:"actions",sortable:!1}],a=[{title:n("searchEngine.filters.category.movies"),value:"movies"},{title:n("searchEngine.filters.category.tv"),value:"tv"},{title:n("searchEngine.filters.category.music"),value:"music"},{title:n("searchEngine.filters.category.games"),value:"games"},{title:n("searchEngine.filters.category.anime"),value:"anime"},{title:n("searchEngine.filters.category.software"),value:"software"},{title:n("searchEngine.filters.category.pictures"),value:"pictures"},{title:n("searchEngine.filters.category.books"),value:"books"}];a.sort((t,f)=>t.title.localeCompare(f.title));const E=[{title:n("searchEngine.filters.category.all"),value:"all"},...a],B=Q(()=>{const t=[{title:n("searchEngine.filters.plugins.all"),value:"all"},{title:n("searchEngine.filters.plugins.enabled"),value:"enabled"}];return c.searchPlugins.filter(f=>f.enabled).forEach(f=>{t.push({title:f.name,value:f.name})}),t}),d=Q(()=>r.value[p.value]??{}),{results:I}=xe(()=>d.value.results,()=>d.value.filters?.title,t=>t.fileName);function h(){c.createNewTab(),p.value=r.value.length-1,v.value?.focus()}function V(){r.value.length!==1&&(c.deleteTab(d.value.uniqueId),p.value=Math.min(p.value,r.value.length-1))}function o(t){s.pushTorrentToQueue(t.fileUrl)}async function M(){await c.runNewSearch(d.value),d.value.timer=setInterval(()=>ie(d.value),1e3)}async function R(t){await c.stopSearch(t),t.timer&&clearInterval(t.timer)}function se(){r.value.forEach(R)}async function ie(t){await c.refreshResults(t)==="Stopped"&&await R(t)}const F=()=>{w.push({name:"dashboard"})};function re(){i.createDialog(Be)}function K(t){if(i.hasActiveDialog||y.value)return!1;t.key==="Escape"&&F()}return ge(async()=>{document.addEventListener("keydown",K),r.value.length===0?c.createNewTab():r.value.forEach(t=>{t.id&&t.id!==0&&(t.timer=setInterval(()=>c.refreshResults(t),1e3))}),await c.fetchSearchPlugins()}),me(()=>{document.removeEventListener("keydown",K),r.value.forEach(t=>{t.timer&&clearInterval(t.timer)})}),(t,f)=>($(),O("div",Re,[e(N,{"no-gutters":"",align:"center",justify:"center"},{default:l(()=>[e(x,null,{default:l(()=>[q("h1",Le,k(C(n)("searchEngine.title")),1)]),_:1}),e(x,null,{default:l(()=>[q("div",ze,[e(S,{icon:"mdi-stop",variant:"plain",color:"error",onClick:se}),e(S,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:re}),e(S,{icon:"mdi-close",variant:"plain",onClick:F})])]),_:1})]),_:1}),e(N,{class:"ma-0 pa-0"},{default:l(()=>[e($e,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:l(()=>[e(qe,{modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=g=>p.value=g),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:l(()=>[($(!0),O(he,null,ve(C(r),g=>($(),D(Ie,{key:g.uniqueId},{default:l(()=>[q("h4",null,k(!g.query||g.query.length===0?t.$t("searchEngine.tabHeaderEmpty"):g.query),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(U),e(S,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:h}),e(S,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:C(r).length===1,onClick:V},null,8,["disabled"])]),_:1})]),_:1}),e(Te,null,{default:l(()=>[e(X,null,{default:l(()=>[e(N,{class:"mt-1"},{default:l(()=>[e(x,{cols:"12",md:"6"},{default:l(()=>[e(A,{modelValue:d.value.query,"onUpdate:modelValue":f[1]||(f[1]=g=>d.value.query=g),ref_key:"queryInput",ref:v,autofocus:"",density:"compact","hide-details":"",clearable:"",label:t.$t("searchEngine.query"),onKeydown:pe(le(M,["prevent"]),["enter"])},null,8,["modelValue","label","onKeydown"])]),_:1}),e(x,{cols:"6",sm:"5",md:"2"},{default:l(()=>[e(Z,{modelValue:d.value.filters.category,"onUpdate:modelValue":f[2]||(f[2]=g=>d.value.filters.category=g),height:"1",variant:"outlined",density:"compact","hide-details":"",items:E,label:t.$t("searchEngine.filters.category.label")},null,8,["modelValue","label"])]),_:1}),e(x,{cols:"6",sm:"5",md:"2"},{default:l(()=>[e(Z,{modelValue:d.value.filters.plugin,"onUpdate:modelValue":f[3]||(f[3]=g=>d.value.filters.plugin=g),flat:"",density:"compact","hide-details":"",variant:"outlined",items:B.value,label:t.$t("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(x,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:l(()=>[d.value.id===0?($(),D(S,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:M},{default:l(()=>[T(k(t.$t("searchEngine.runSearch")),1)]),_:1})):($(),D(S,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:f[4]||(f[4]=g=>R(d.value))},{default:l(()=>[T(k(t.$t("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(Me,{class:"my-3"}),e(X,null,{default:l(()=>[e(te,{headers:b,items:C(I),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":d.value.itemsPerPage},{top:l(()=>[e(N,null,{default:l(()=>[e(x,{cols:"12"},{default:l(()=>[e(A,{modelValue:d.value.filters.title,"onUpdate:modelValue":f[5]||(f[5]=g=>d.value.filters.title=g),density:"compact","hide-details":"",label:t.$t("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":l(({item:g})=>[T(k(C(Ne)(g.fileSize,C(m).useBinarySize)),1)]),"item.actions":l(({item:g})=>[e(S,{icon:"mdi-download",variant:"flat",density:"compact",onClick:je=>o(g)},null,8,["onClick"])]),_:1},8,["items","items-per-page"])]),_:1})]),_:1})]))}});export{Oe as default};
