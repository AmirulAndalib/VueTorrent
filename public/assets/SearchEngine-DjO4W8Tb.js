import{a0 as de,d as w,h as z,c as U,B as E,D as x,G as a,I as _,J as p,M as Q,N as A,m as e,S as $,n as fe,u as i,K as F,O as ge,P as me,Q as G,H as pe,q as he,F as ve,T as ye,L as Se}from"./vue-DoAIX5qv.js";import{Z as ke,$ as P,V as H,k as h,c as Ve,u as le,d as J,e as be,j as q,l as W,f as Y,g as we,a as te,i as Z,a0 as ne,w as Ee,E as Pe,G as _e,F as Te,o as Ce,a1 as Ne,a2 as xe,q as M,r as De,s as N,H as Ie,a3 as $e,a4 as Me,t as X,M as Ue,N as qe,v as ee,x as Re,a5 as Be,a6 as Le,a7 as Qe}from"./index-Plxi_YY5.js";import{a as Ae}from"./vuetify-9zKwU_dq.js";const se=de("searchEngine",()=>{const S=w([]),k=w([]);function l(){S.value.push({uniqueId:ke(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function m(t){S.value=S.value.filter(v=>v.uniqueId!==t)}async function o(t){const v=await P.startSearch(t.query,t.filters.category,[t.filters.plugin]);t.id=v.id,t.results=[],t.lastQuery=t.query}async function T(t){const v=await P.getSearchResults(t.id,t.results.length);return t.results.push(...v.results),v.status}async function c(t){t.id&&t.id!==0&&await P.stopSearch(t.id),t.id=0}async function f(){k.value=await P.getSearchPlugins()}async function C(t){await P.installSearchPlugin([t])}async function D(t){await P.uninstallSearchPlugin([t])}async function V(t){await P.enableSearchPlugin([t.name],!t.enabled)}async function I(){await P.updateSearchPlugins()}async function b(t,v){await P.downloadTorrentWithSearchPlugin(t,v)}return{searchData:S,searchPlugins:k,createNewTab:l,deleteTab:m,runNewSearch:o,refreshResults:T,stopSearch:c,fetchSearchPlugins:f,installSearchPlugin:C,uninstallSearchPlugin:D,toggleSearchPlugin:V,updatePlugins:I,downloadTorrent:b,$reset:()=>{S.value=[],k.value=[],l()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),Fe={key:1,"data-testid":"mixedbtn-text"},ae=z({__name:"MixedButton",props:{mobileOverride:{type:Boolean,default:!1},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(S){const k=S,{mobile:l}=Ae(),m=U(()=>k.mobileOverride?k.mobileValue:l.value);return(o,T)=>(E(),x(h,{icon:m.value},{default:a(()=>[m.value||o.position==="left"?(E(),x(H,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[_(p(o.icon),1)]),_:1})):Q("",!0),m.value?Q("",!0):(E(),A("span",Fe,p(o.text),1)),!m.value&&o.position==="right"?(E(),x(H,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[_(p(o.icon),1)]),_:1})):Q("",!0)]),_:1},8,["icon"]))}}),He=["href","title"],ze=z({__name:"PluginManagerDialog",props:{guid:{}},setup(S){const k=S,{isOpened:l}=Ve(k.guid),{t:m}=le(),o=se(),T=[{title:m("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:m("dialogs.pluginManager.headers.name"),key:"fullName"},{title:m("dialogs.pluginManager.headers.version"),key:"version"},{title:m("dialogs.pluginManager.headers.url"),key:"url"},{title:m("dialogs.pluginManager.headers.actions"),key:"actions"}],c=w(!1),f=w(!1),C=w(!1),D=w(!1),V=w("");async function I(g){await o.toggleSearchPlugin(g),await o.fetchSearchPlugins()}async function b(){f.value=!0,await o.updatePlugins().then(()=>new Promise(g=>setTimeout(g,2e3))),await o.fetchSearchPlugins(),f.value=!1}async function t(){r(),c.value=!0,await o.installSearchPlugin(V.value),V.value="",setTimeout(()=>{o.fetchSearchPlugins().then(()=>{c.value=!1})},1e3)}async function v(g){c.value=!0,await o.uninstallSearchPlugin(g.name),await o.fetchSearchPlugins(),c.value=!1}const R=()=>{l.value=!1};function r(){C.value=!1}return(g,y)=>(E(),x(W,{modelValue:i(l),"onUpdate:modelValue":y[4]||(y[4]=u=>ge(l)?l.value=u:null)},{default:a(()=>[e(J,null,{default:a(()=>[e(be,{class:"d-flex"},{default:a(()=>[$("div",null,p(g.$t("dialogs.pluginManager.title")),1),e(q),e(ae,{icon:"mdi-update",text:g.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:f.value,onClick:b},null,8,["text","loading"]),e(W,{modelValue:C.value,"onUpdate:modelValue":y[3]||(y[3]=u=>C.value=u)},{activator:a(({props:u})=>[e(ae,fe({icon:"mdi-toy-brick-plus",text:g.$t("dialogs.pluginManager.install.activator")},u,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(J,{title:g.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(Y,null,{default:a(()=>[e(i(we),{modelValue:D.value,"onUpdate:modelValue":y[1]||(y[1]=u=>D.value=u),onSubmit:y[2]||(y[2]=F(()=>{},["prevent"]))},{default:a(()=>[e(te,{modelValue:V.value,"onUpdate:modelValue":y[0]||(y[0]=u=>V.value=u),autofocus:"",label:g.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(Z,null,{default:a(()=>[e(q),e(h,{color:"error",onClick:r},{default:a(()=>[_(p(g.$t("common.cancel")),1)]),_:1}),e(h,{color:"accent",onClick:t},{default:a(()=>[_(p(g.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(Y,null,{default:a(()=>[e(ne,{mobile:null,headers:T,"items-per-page":"-1",items:i(o).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:c.value},{"item.enabled":a(({item:u})=>[e(Ee,{"model-value":u.enabled,onClick:B=>I(u)},null,8,["model-value","onClick"])]),"item.url":a(({item:u})=>[$("a",{href:u.url,title:u.name},p(u.url),9,He)]),"item.actions":a(({item:u})=>[e(H,{color:"red",icon:"mdi-delete",onClick:B=>v(u)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(Z,null,{default:a(()=>[e(q),e(h,{color:"accent",onClick:R},{default:a(()=>[_(p(g.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ke={class:"pa-3"},Oe={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},je={class:"d-flex justify-end"},Ye=z({__name:"SearchEngine",setup(S){const k=me(),{t:l}=le(),m=Pe(),o=_e(),T=Te(),c=se(),{searchData:f}=G(c),{useBinarySize:C,dateFormat:D}=G(Ce()),V=w(),I=w(!1),b=w(0),t=U(()=>[{title:l("searchEngine.headers.fileName"),key:"fileName"},{title:l("searchEngine.headers.fileSize"),key:"fileSize"},{title:l("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:l("searchEngine.headers.nbLeechers"),key:"nbLeechers"},...o.usesQbit5?[{title:l("searchEngine.headers.engineName"),key:"engineName"},{title:l("searchEngine.headers.pubDate"),key:"pubDate"}]:[{title:l("searchEngine.headers.siteUrl"),key:"siteUrl"}],{title:"",key:"actions",sortable:!1}]),v=[{title:l("searchEngine.filters.category.movies"),value:"movies"},{title:l("searchEngine.filters.category.tv"),value:"tv"},{title:l("searchEngine.filters.category.music"),value:"music"},{title:l("searchEngine.filters.category.games"),value:"games"},{title:l("searchEngine.filters.category.anime"),value:"anime"},{title:l("searchEngine.filters.category.software"),value:"software"},{title:l("searchEngine.filters.category.pictures"),value:"pictures"},{title:l("searchEngine.filters.category.books"),value:"books"}].sort((n,d)=>Ne.text.asc(n.title,d.title)).toSpliced(0,0,{title:l("searchEngine.filters.category.all"),value:"all"}),R=U(()=>{const n=[{title:l("searchEngine.filters.plugins.all"),value:"all"},{title:l("searchEngine.filters.plugins.enabled"),value:"enabled"}];return c.searchPlugins.filter(d=>d.enabled).forEach(d=>{n.push({title:d.name,value:d.name})}),n}),r=U(()=>f.value[b.value]??{}),{results:g}=xe(()=>r.value.results,()=>r.value.filters?.title,n=>n.fileName);function y(){c.createNewTab(),b.value=f.value.length-1,V.value?.focus()}function u(){f.value.length!==1&&(c.deleteTab(r.value.uniqueId),b.value=Math.min(b.value,f.value.length-1))}function B(n){o.usesQbit5?c.downloadTorrent(n.fileUrl,n.engineName):m.pushTorrentToQueue(n.fileUrl),n.downloaded=!0}function ie(n){Qe(n.descrLink)}async function K(){await c.runNewSearch(r.value),r.value.timer=setInterval(()=>re(r.value),1e3),V.value?.saveValueToHistory()}async function L(n){await c.stopSearch(n),n.timer&&clearInterval(n.timer)}function oe(){f.value.forEach(L)}async function re(n){await c.refreshResults(n)==="Stopped"&&await L(n)}const O=()=>{k.push({name:"dashboard"})};function ue(){T.createDialog(ze)}function j(n){if(T.hasActiveDialog||I.value)return!1;n.key==="Escape"&&O()}return pe(async()=>{document.addEventListener("keydown",j),f.value.length===0?c.createNewTab():f.value.forEach(n=>{n.id&&n.id!==0&&(n.timer=setInterval(()=>c.refreshResults(n),1e3))}),await c.fetchSearchPlugins()}),he(()=>{document.removeEventListener("keydown",j),f.value.forEach(n=>{n.timer&&clearInterval(n.timer)})}),(n,d)=>(E(),A("div",Ke,[e(M,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(N,null,{default:a(()=>[$("h1",Oe,p(i(l)("searchEngine.title")),1)]),_:1}),e(N,null,{default:a(()=>[$("div",je,[e(h,{icon:"mdi-stop",variant:"plain",color:"error",onClick:oe}),e(h,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:ue}),e(h,{icon:"mdi-close",variant:"plain",onClick:O})])]),_:1})]),_:1}),e(M,{class:"ma-0 pa-0"},{default:a(()=>[e(Ie,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e($e,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=s=>b.value=s),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(E(!0),A(ve,null,ye(i(f),s=>(E(),x(Me,{key:s.uniqueId},{default:a(()=>[$("h4",null,p(!s.lastQuery||s.lastQuery.length===0?i(l)("searchEngine.tabHeaderEmpty"):s.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(q),e(h,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:y}),e(h,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:i(f).length===1,onClick:u},null,8,["disabled"])]),_:1})]),_:1}),e(De,null,{default:a(()=>[e(X,null,{default:a(()=>[e(M,{class:"mt-1"},{default:a(()=>[e(N,{cols:"12",md:"6"},{default:a(()=>[e(Ue,{modelValue:r.value.query,"onUpdate:modelValue":d[1]||(d[1]=s=>r.value.query=s),"history-key":i(qe).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:V,autofocus:"",density:"compact","hide-details":"",clearable:"",label:i(l)("searchEngine.query"),onKeydown:Se(F(K,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ee,{modelValue:r.value.filters.category,"onUpdate:modelValue":d[2]||(d[2]=s=>r.value.filters.category=s),height:"1",variant:"outlined",density:"compact","hide-details":"",items:i(v),label:i(l)("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ee,{modelValue:r.value.filters.plugin,"onUpdate:modelValue":d[3]||(d[3]=s=>r.value.filters.plugin=s),flat:"",density:"compact","hide-details":"",variant:"outlined",items:R.value,label:i(l)("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[r.value.id===0?(E(),x(h,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:K},{default:a(()=>[_(p(i(l)("searchEngine.runSearch")),1)]),_:1})):(E(),x(h,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:d[4]||(d[4]=s=>L(r.value))},{default:a(()=>[_(p(i(l)("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(Re,{class:"my-3"}),e(X,{class:"text-select"},{default:a(()=>[e(ne,{mobile:null,headers:t.value,items:i(g),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":r.value.itemsPerPage},{top:a(()=>[e(M,null,{default:a(()=>[e(N,{cols:"12"},{default:a(()=>[e(te,{modelValue:r.value.filters.title,"onUpdate:modelValue":d[5]||(d[5]=s=>r.value.filters.title=s),density:"compact","hide-details":"",label:i(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:s})=>[_(p(i(Be)(s.fileSize,i(C))),1)]),"item.pubDate":a(({value:s})=>[_(p(s===-1?i(l)("common.NA"):i(Le)(s,i(D))),1)]),"item.actions":a(({item:s})=>[e(h,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:F(ce=>ie(s),["stop"])},null,8,["onClick"]),e(h,{icon:s.downloaded?"mdi-check":"mdi-download",color:s.downloaded&&"accent",variant:"text",density:"compact",onClick:ce=>B(s)},null,8,["icon","color","onClick"])]),_:2},1032,["headers","items","items-per-page"])]),_:1})]),_:1})]))}});export{Ye as default};
